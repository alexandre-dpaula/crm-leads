"use strict";(()=>{var e={};e.id=252,e.ids=[252],e.modules={3524:e=>{e.exports=require("@prisma/client")},2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2781:e=>{e.exports=require("stream")},3837:e=>{e.exports=require("util")},8926:(e,s,a)=>{a.r(s),a.d(s,{originalPathname:()=>_,patchFetch:()=>v,requestAsyncStorage:()=>x,routeModule:()=>w,serverHooks:()=>h,staticGenerationAsyncStorage:()=>g});var r={};a.r(r),a.d(r,{DELETE:()=>f,GET:()=>m,PUT:()=>p});var t=a(9303),n=a(8716),o=a(670),i=a(7070),d=a(3524),l=a(2331),u=a(5852),c=a(2502);async function m(e,{params:s}){let a=await (0,u.ts)();if(!a)return i.NextResponse.json({message:"N\xe3o autenticado"},{status:401});let r=await l._.lead.findFirst({where:{id:s.id,userId:a.id}});return r?i.NextResponse.json({lead:r}):i.NextResponse.json({message:"Lead n\xe3o encontrado"},{status:404})}async function p(e,{params:s}){let a=await (0,u.ts)();if(!a)return i.NextResponse.json({message:"N\xe3o autenticado"},{status:401});try{let r=await l._.lead.findFirst({where:{id:s.id,userId:a.id}});if(!r)return i.NextResponse.json({message:"Lead n\xe3o encontrado"},{status:404});let t=await e.json(),n=c.sL.safeParse(t);if(!n.success)return i.NextResponse.json({errors:n.error.flatten().fieldErrors},{status:400});let{name:o,company:u,email:m,phone:p,value:f,notes:w,stageId:x,position:g}=n.data;if(x&&!await l._.leadStage.findFirst({where:{id:x,userId:a.id}}))return i.NextResponse.json({message:"Est\xe1gio inv\xe1lido"},{status:400});let h={name:o,company:u||null,email:m||null,phone:p||null,notes:w||null,stage:x?{connect:{id:x}}:void 0};void 0!==f&&(h.value=new d.Prisma.Decimal(f)),void 0!==g&&(h.position=g),x||(h.stage=r.stageId?{connect:{id:r.stageId}}:void 0);let _=await l._.lead.update({where:{id:s.id},data:h,include:{stage:!0}});return i.NextResponse.json({lead:_})}catch(e){return console.error("Update lead error",e),i.NextResponse.json({message:"Erro ao atualizar lead"},{status:500})}}async function f(e,{params:s}){let a=await (0,u.ts)();if(!a)return i.NextResponse.json({message:"N\xe3o autenticado"},{status:401});try{if(!await l._.lead.findFirst({where:{id:s.id,userId:a.id}}))return i.NextResponse.json({message:"Lead n\xe3o encontrado"},{status:404});return await l._.lead.delete({where:{id:s.id}}),i.NextResponse.json({success:!0})}catch(e){return console.error("Delete lead error",e),i.NextResponse.json({message:"Erro ao excluir lead"},{status:500})}}let w=new t.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/leads/[id]/route",pathname:"/api/leads/[id]",filename:"route",bundlePath:"app/api/leads/[id]/route"},resolvedPagePath:"/Users/alexandredpaula/SaaS DEV/CRM Leads V2/app/api/leads/[id]/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:x,staticGenerationAsyncStorage:g,serverHooks:h}=w,_="/api/leads/[id]/route";function v(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:g})}},5852:(e,s,a)=>{a.d(s,{I2:()=>w,ts:()=>x,c_:()=>m,MY:()=>f,VC:()=>u,Gv:()=>p});var r=a(1615),t=a(2023),n=a.n(t),o=a(2331),i=a(1482),d=a.n(i);function l(){let e=process.env.JWT_SECRET;if(!e)throw Error("JWT_SECRET n\xe3o configurado");return e}function u(e){return d().sign({userId:e},l(),{expiresIn:"8h"})}let c="flowcrm_session";async function m(e){let s=await n().genSalt(10);return n().hash(e,s)}async function p(e,s){return n().compare(e,s)}function f(e){(0,r.cookies)().set({name:c,value:e,httpOnly:!0,secure:!0,path:"/",sameSite:"lax",maxAge:28800})}function w(){(0,r.cookies)().delete(c)}async function x(){let e=r.cookies().get(c)?.value;if(!e)return null;let s=function(e){try{return d().verify(e,l())}catch(e){return null}}(e);return s?.userId?o._.user.findUnique({where:{id:s.userId}}):null}},2331:(e,s,a)=>{a.d(s,{_:()=>t});var r=a(3524);let t=globalThis.prisma??new r.PrismaClient({log:["error"]})},2502:(e,s,a)=>{a.d(s,{CF:()=>d,dm:()=>o,gY:()=>n,jE:()=>u,sL:()=>i,sY:()=>m,tw:()=>c,yV:()=>l});var r=a(1585),t=a(6033);let n=r.Ry({name:r.Z_().min(2,"Informe pelo menos 2 caracteres"),email:r.Z_().email("E-mail inv\xe1lido"),password:r.Z_().min(6,"M\xednimo de 6 caracteres"),confirmPassword:r.Z_().min(6)}).refine(e=>e.password===e.confirmPassword,{message:"As senhas n\xe3o conferem",path:["confirmPassword"]}),o=r.Ry({email:r.Z_().email("E-mail inv\xe1lido"),password:r.Z_().min(1,"Informe a senha")}),i=r.Ry({name:r.Z_().min(2,"Informe o nome do lead"),stageId:r.Z_().optional(),company:r.Z_().optional(),email:r.Z_().email().optional().or(r.i0("")),phone:r.Z_().optional(),position:r.Rx().optional(),value:r.Yj().optional().transform(e=>{if(null==e||""===e)return;let s="number"==typeof e?e:Number(e);return Number.isFinite(s)?s:void 0}).refine(e=>void 0===e||!Number.isNaN(e),"Valor inv\xe1lido"),notes:r.Z_().max(2e3).optional()}),d=r.Ry({id:r.Z_(),name:r.Z_().min(2),order:r.Rx().min(0)}),l=r.Ry({id:r.Z_(),stageId:r.Z_(),position:r.Rx()}),u=r.Ry({name:r.Z_().min(2),email:r.Z_().email(),currentPassword:r.Z_().optional(),newPassword:r.Z_().optional(),confirmPassword:r.Z_().optional(),avatarData:r.Z_().optional()}).superRefine((e,s)=>{(e.newPassword||e.confirmPassword)&&(e.currentPassword||s.addIssue({code:t.NL.custom,message:"Informe a senha atual para alterar a senha.",path:["currentPassword"]}),(!e.newPassword||e.newPassword.length<6)&&s.addIssue({code:t.NL.custom,message:"Nova senha deve ter ao menos 6 caracteres.",path:["newPassword"]}),e.newPassword!==e.confirmPassword&&s.addIssue({code:t.NL.custom,message:"As senhas n\xe3o conferem.",path:["confirmPassword"]}))}),c=r.Ry({email:r.Z_().email()}),m=r.Ry({token:r.Z_(),password:r.Z_().min(6),confirmPassword:r.Z_().min(6)}).refine(e=>e.password===e.confirmPassword,{message:"As senhas n\xe3o conferem",path:["confirmPassword"]})}};var s=require("../../../../webpack-runtime.js");s.C(e);var a=e=>s(s.s=e),r=s.X(0,[948,954,972,585],()=>a(8926));module.exports=r})();