"use strict";(()=>{var e={};e.id=2,e.ids=[2],e.modules={3524:e=>{e.exports=require("@prisma/client")},2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2781:e=>{e.exports=require("stream")},3837:e=>{e.exports=require("util")},3760:(e,r,a)=>{a.r(r),a.d(r,{originalPathname:()=>g,patchFetch:()=>_,requestAsyncStorage:()=>f,routeModule:()=>p,serverHooks:()=>h,staticGenerationAsyncStorage:()=>w});var s={};a.r(s),a.d(s,{POST:()=>c});var t=a(9303),n=a(8716),o=a(670),i=a(7070),u=a(2331),d=a(2502),m=a(5852);let l=[{name:"Novo",order:0},{name:"Em Contato",order:1},{name:"Fechamento",order:2},{name:"Conclu\xeddo",order:3}];async function c(e){try{let r=await e.json(),a=d.gY.safeParse(r);if(!a.success)return i.NextResponse.json({errors:a.error.flatten().fieldErrors},{status:400});let{name:s,email:t,password:n}=a.data;if(await u._.user.findUnique({where:{email:t}}))return i.NextResponse.json({message:"E-mail j\xe1 cadastrado."},{status:409});let o=await (0,m.c_)(n),c=await u._.$transaction(async e=>{let r=await e.user.create({data:{name:s,email:t,passwordHash:o}});return await e.leadStage.createMany({data:l.map(e=>({...e,userId:r.id}))}),r}),p=(0,m.VC)(c.id);return(0,m.MY)(p),i.NextResponse.json({user:{id:c.id,name:c.name,email:c.email}})}catch(e){return console.error("Register error",e),i.NextResponse.json({message:"Erro ao registrar"},{status:500})}}let p=new t.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/auth/register/route",pathname:"/api/auth/register",filename:"route",bundlePath:"app/api/auth/register/route"},resolvedPagePath:"/Users/alexandredpaula/SaaS DEV/CRM Leads V2/app/api/auth/register/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:w,serverHooks:h}=p,g="/api/auth/register/route";function _(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:w})}},5852:(e,r,a)=>{a.d(r,{I2:()=>w,ts:()=>h,c_:()=>c,MY:()=>f,VC:()=>m,Gv:()=>p});var s=a(1615),t=a(2023),n=a.n(t),o=a(2331),i=a(1482),u=a.n(i);function d(){let e=process.env.JWT_SECRET;if(!e)throw Error("JWT_SECRET n\xe3o configurado");return e}function m(e){return u().sign({userId:e},d(),{expiresIn:"8h"})}let l="flowcrm_session";async function c(e){let r=await n().genSalt(10);return n().hash(e,r)}async function p(e,r){return n().compare(e,r)}function f(e){(0,s.cookies)().set({name:l,value:e,httpOnly:!0,secure:!0,path:"/",sameSite:"lax",maxAge:28800})}function w(){(0,s.cookies)().delete(l)}async function h(){let e=s.cookies().get(l)?.value;if(!e)return null;let r=function(e){try{return u().verify(e,d())}catch(e){return null}}(e);return r?.userId?o._.user.findUnique({where:{id:r.userId}}):null}},2331:(e,r,a)=>{a.d(r,{_:()=>t});var s=a(3524);let t=globalThis.prisma??new s.PrismaClient({log:["error"]})},2502:(e,r,a)=>{a.d(r,{CF:()=>u,dm:()=>o,gY:()=>n,jE:()=>m,sL:()=>i,sY:()=>c,tw:()=>l,yV:()=>d});var s=a(1585),t=a(6033);let n=s.Ry({name:s.Z_().min(2,"Informe pelo menos 2 caracteres"),email:s.Z_().email("E-mail inv\xe1lido"),password:s.Z_().min(6,"M\xednimo de 6 caracteres"),confirmPassword:s.Z_().min(6)}).refine(e=>e.password===e.confirmPassword,{message:"As senhas n\xe3o conferem",path:["confirmPassword"]}),o=s.Ry({email:s.Z_().email("E-mail inv\xe1lido"),password:s.Z_().min(1,"Informe a senha")}),i=s.Ry({name:s.Z_().min(2,"Informe o nome do lead"),stageId:s.Z_().optional(),company:s.Z_().optional(),email:s.Z_().email().optional().or(s.i0("")),phone:s.Z_().optional(),position:s.Rx().optional(),value:s.Yj().optional().transform(e=>{if(null==e||""===e)return;let r="number"==typeof e?e:Number(e);return Number.isFinite(r)?r:void 0}).refine(e=>void 0===e||!Number.isNaN(e),"Valor inv\xe1lido"),notes:s.Z_().max(2e3).optional()}),u=s.Ry({id:s.Z_(),name:s.Z_().min(2),order:s.Rx().min(0)}),d=s.Ry({id:s.Z_(),stageId:s.Z_(),position:s.Rx()}),m=s.Ry({name:s.Z_().min(2),email:s.Z_().email(),currentPassword:s.Z_().optional(),newPassword:s.Z_().optional(),confirmPassword:s.Z_().optional(),avatarData:s.Z_().optional()}).superRefine((e,r)=>{(e.newPassword||e.confirmPassword)&&(e.currentPassword||r.addIssue({code:t.NL.custom,message:"Informe a senha atual para alterar a senha.",path:["currentPassword"]}),(!e.newPassword||e.newPassword.length<6)&&r.addIssue({code:t.NL.custom,message:"Nova senha deve ter ao menos 6 caracteres.",path:["newPassword"]}),e.newPassword!==e.confirmPassword&&r.addIssue({code:t.NL.custom,message:"As senhas n\xe3o conferem.",path:["confirmPassword"]}))}),l=s.Ry({email:s.Z_().email()}),c=s.Ry({token:s.Z_(),password:s.Z_().min(6),confirmPassword:s.Z_().min(6)}).refine(e=>e.password===e.confirmPassword,{message:"As senhas n\xe3o conferem",path:["confirmPassword"]})}};var r=require("../../../../webpack-runtime.js");r.C(e);var a=e=>r(r.s=e),s=r.X(0,[948,954,972,585],()=>a(3760));module.exports=s})();