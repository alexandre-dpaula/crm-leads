"use strict";(()=>{var e={};e.id=401,e.ids=[401],e.modules={3524:e=>{e.exports=require("@prisma/client")},2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2781:e=>{e.exports=require("stream")},3837:e=>{e.exports=require("util")},2904:(e,r,s)=>{s.r(r),s.d(r,{originalPathname:()=>h,patchFetch:()=>_,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>w,staticGenerationAsyncStorage:()=>f});var a={};s.r(a),s.d(a,{POST:()=>c});var n=s(9303),t=s(8716),o=s(670),i=s(7070),u=s(2331),d=s(5852),m=s(2502);async function c(e){try{let r=await e.json(),s=m.sY.safeParse(r);if(!s.success)return i.NextResponse.json({errors:s.error.flatten().fieldErrors},{status:400});let{token:a,password:n}=s.data,t=await u._.passwordResetToken.findUnique({where:{token:a}});if(!t||t.usedAt||t.expiresAt<new Date)return i.NextResponse.json({message:"Token inv\xe1lido ou expirado"},{status:400});let o=await (0,d.c_)(n);return await u._.$transaction([u._.user.update({where:{id:t.userId},data:{passwordHash:o}}),u._.passwordResetToken.update({where:{id:t.id},data:{usedAt:new Date}})]),i.NextResponse.json({message:"Senha atualizada com sucesso."})}catch(e){return console.error("Reset confirm error",e),i.NextResponse.json({message:"Erro ao resetar senha"},{status:500})}}let l=new n.AppRouteRouteModule({definition:{kind:t.x.APP_ROUTE,page:"/api/auth/reset/confirm/route",pathname:"/api/auth/reset/confirm",filename:"route",bundlePath:"app/api/auth/reset/confirm/route"},resolvedPagePath:"/Users/alexandredpaula/SaaS DEV/CRM Leads V2/app/api/auth/reset/confirm/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:p,staticGenerationAsyncStorage:f,serverHooks:w}=l,h="/api/auth/reset/confirm/route";function _(){return(0,o.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:f})}},5852:(e,r,s)=>{s.d(r,{I2:()=>w,ts:()=>h,c_:()=>l,MY:()=>f,VC:()=>m,Gv:()=>p});var a=s(1615),n=s(2023),t=s.n(n),o=s(2331),i=s(1482),u=s.n(i);function d(){let e=process.env.JWT_SECRET;if(!e)throw Error("JWT_SECRET n\xe3o configurado");return e}function m(e){return u().sign({userId:e},d(),{expiresIn:"8h"})}let c="flowcrm_session";async function l(e){let r=await t().genSalt(10);return t().hash(e,r)}async function p(e,r){return t().compare(e,r)}function f(e){(0,a.cookies)().set({name:c,value:e,httpOnly:!0,secure:!0,path:"/",sameSite:"lax",maxAge:28800})}function w(){(0,a.cookies)().delete(c)}async function h(){let e=a.cookies().get(c)?.value;if(!e)return null;let r=function(e){try{return u().verify(e,d())}catch(e){return null}}(e);return r?.userId?o._.user.findUnique({where:{id:r.userId}}):null}},2331:(e,r,s)=>{s.d(r,{_:()=>n});var a=s(3524);let n=globalThis.prisma??new a.PrismaClient({log:["error"]})},2502:(e,r,s)=>{s.d(r,{CF:()=>u,dm:()=>o,gY:()=>t,jE:()=>m,sL:()=>i,sY:()=>l,tw:()=>c,yV:()=>d});var a=s(1585),n=s(6033);let t=a.Ry({name:a.Z_().min(2,"Informe pelo menos 2 caracteres"),email:a.Z_().email("E-mail inv\xe1lido"),password:a.Z_().min(6,"M\xednimo de 6 caracteres"),confirmPassword:a.Z_().min(6)}).refine(e=>e.password===e.confirmPassword,{message:"As senhas n\xe3o conferem",path:["confirmPassword"]}),o=a.Ry({email:a.Z_().email("E-mail inv\xe1lido"),password:a.Z_().min(1,"Informe a senha")}),i=a.Ry({name:a.Z_().min(2,"Informe o nome do lead"),stageId:a.Z_().optional(),company:a.Z_().optional(),email:a.Z_().email().optional().or(a.i0("")),phone:a.Z_().optional(),position:a.Rx().optional(),value:a.Yj().optional().transform(e=>{if(null==e||""===e)return;let r="number"==typeof e?e:Number(e);return Number.isFinite(r)?r:void 0}).refine(e=>void 0===e||!Number.isNaN(e),"Valor inv\xe1lido"),notes:a.Z_().max(2e3).optional()}),u=a.Ry({id:a.Z_(),name:a.Z_().min(2),order:a.Rx().min(0)}),d=a.Ry({id:a.Z_(),stageId:a.Z_(),position:a.Rx()}),m=a.Ry({name:a.Z_().min(2),email:a.Z_().email(),currentPassword:a.Z_().optional(),newPassword:a.Z_().optional(),confirmPassword:a.Z_().optional(),avatarData:a.Z_().optional()}).superRefine((e,r)=>{(e.newPassword||e.confirmPassword)&&(e.currentPassword||r.addIssue({code:n.NL.custom,message:"Informe a senha atual para alterar a senha.",path:["currentPassword"]}),(!e.newPassword||e.newPassword.length<6)&&r.addIssue({code:n.NL.custom,message:"Nova senha deve ter ao menos 6 caracteres.",path:["newPassword"]}),e.newPassword!==e.confirmPassword&&r.addIssue({code:n.NL.custom,message:"As senhas n\xe3o conferem.",path:["confirmPassword"]}))}),c=a.Ry({email:a.Z_().email()}),l=a.Ry({token:a.Z_(),password:a.Z_().min(6),confirmPassword:a.Z_().min(6)}).refine(e=>e.password===e.confirmPassword,{message:"As senhas n\xe3o conferem",path:["confirmPassword"]})}};var r=require("../../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),a=r.X(0,[948,954,972,585],()=>s(2904));module.exports=a})();